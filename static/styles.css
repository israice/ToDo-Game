/* Quest Todo - Mobile-First Styles (Optimized with CSS Nesting) */

:root {
  /* Colors */
  --bg-primary: #0f0f1a;
  --bg-secondary: #1a1a2e;
  --bg-card: #252542;
  --accent-primary: #6c5ce7;
  --accent-secondary: #a29bfe;
  --accent-success: #00d9a5;
  --accent-warning: #ffeaa7;
  --accent-fire: #ff6b6b;
  --text-primary: #ffffff;
  --text-secondary: #b2b2d8;
  --text-muted: #8585a8;
  --border-color: #3d3d5c;
  --shadow-color: rgba(108, 92, 231, 0.3);
  /* Spacing */
  --spacing-xs: 4px;
  --spacing-sm: 8px;
  --spacing-md: 12px;
  --spacing-lg: 16px;
  --spacing-xl: 20px;
  /* Transitions */
  --transition-fast: 0.2s ease;
  --transition-normal: 0.3s ease;
  --transition-slow: 0.5s ease;
}

* { margin: 0; padding: 0; box-sizing: border-box; }

/* ===== FOCUS STYLES ===== */
:focus-visible {
  outline: 2px solid var(--accent-primary);
  outline-offset: 2px;
}

:focus:not(:focus-visible) {
  outline: none;
}

body {
  font-family: 'Segoe UI', system-ui, -apple-system, sans-serif;
  background: var(--bg-primary); color: var(--text-primary);
  min-height: 100vh; overflow-x: hidden;
}

/* ===== ANIMATIONS ===== */
@keyframes shine { 0% { transform: translateX(-100%); } 100% { transform: translateX(100%); } }
@keyframes pulse { 0%, 100% { transform: scale(1); } 50% { transform: scale(1.1); } }
@keyframes slide-in { from { opacity: 0; transform: translateX(-30px); } to { opacity: 1; transform: translateX(0); } }
@keyframes bounce { 0%, 100% { transform: translateY(0); } 50% { transform: translateY(-10px); } }
@keyframes spin { 0%, 100% { transform: rotate(0deg) scale(1); } 50% { transform: rotate(180deg) scale(1.2); } }
@keyframes flicker { 0% { transform: scale(1) rotate(-5deg); } 100% { transform: scale(1.1) rotate(5deg); } }

/* ===== BASE LAYOUT ===== */
.app-container { max-width: 100%; margin: 0 auto; padding: 8px; min-height: 100vh; position: relative; }
.main-content { position: relative; }

#particles { position: fixed; inset: 0; pointer-events: none; z-index: 1000; overflow: hidden; }
.particle { position: absolute; pointer-events: none; }

/* ===== HEADER ===== */
.game-header {
  position: sticky; top: 0; z-index: 50;
  display: flex; flex-direction: column; gap: 4px;
  padding: 6px var(--spacing-md);
  background: var(--bg-secondary); border-radius: 12px; margin-bottom: 8px;
  border: 1px solid var(--border-color); box-shadow: 0 4px 20px rgba(0,0,0,0.3);

  .header-right {
    display: flex; align-items: center; gap: var(--spacing-sm);
    min-width: 0; flex-wrap: nowrap;

    .stats-mini {
      display: flex; gap: var(--spacing-xs); min-width: 0; flex-shrink: 0;

      .stat-item {
        display: flex; align-items: center; gap: 2px; padding: 4px 8px;
        background: var(--bg-card); border-radius: 8px; font-weight: 600; font-size: 0.8rem;
        white-space: nowrap;
      }
      .stat-icon { font-size: 0.85rem; }
    }

    .combo-container {
      display: none; align-items: center; justify-content: center; gap: 4px; padding: 4px 8px;
      background: var(--bg-card); border-radius: 8px; border: 1px solid var(--accent-fire);
      flex: 1; min-width: 0;

      &.active { display: flex; animation: pulse 0.5s ease; }
      .combo-fire { font-size: 0.85rem; animation: flicker 0.3s ease-in-out infinite alternate; }
      .combo-count { font-size: 0.8rem; font-weight: 700; color: var(--accent-fire); }
    }

    .settings-wrapper { position: relative; flex-shrink: 0; margin-left: auto; }
  }

  .level-row {
    display: flex; align-items: center; gap: var(--spacing-sm);
    min-width: 0;

    .settings-wrapper { position: relative; flex-shrink: 0; margin-left: auto; }
  }

  .level-badge {
    display: flex; align-items: center; gap: 4px;
    background: linear-gradient(135deg, var(--accent-primary), var(--accent-secondary));
    padding: 3px 10px; border-radius: 12px; font-weight: 700; font-size: 0.75rem;
    white-space: nowrap; flex-shrink: 0;

    .level-icon { font-size: 0.8rem; animation: spin 3s linear infinite; }
  }

  .xp-container { flex: 1; min-width: 0; }

  .xp-bar {
    position: relative; height: 14px; background: var(--bg-card);
    border-radius: 7px; overflow: hidden; border: 1px solid var(--border-color);

    .xp-fill {
      height: 100%; width: 0%;
      background: linear-gradient(90deg, var(--accent-primary), var(--accent-success));
      border-radius: 6px; transition: width var(--transition-slow);
    }

    .xp-text {
      position: absolute; top: 50%; left: 50%; transform: translate(-50%, -50%);
      font-size: 0.6rem; font-weight: 600; text-shadow: 0 1px 2px rgba(0,0,0,0.5); white-space: nowrap;
    }
  }
}

/* ===== SETTINGS ===== */
.settings-wrapper {
  .settings-btn {
    display: flex; align-items: center; justify-content: center;
    padding: 4px 8px; background: var(--bg-card);
    border: 1px solid var(--border-color); border-radius: 8px;
    cursor: pointer; transition: all var(--transition-fast);
    font-size: 0.85rem; color: var(--accent-success);

    &:hover { background: var(--accent-primary); color: var(--text-primary); border-color: var(--accent-primary); }
  }

  .settings-dropdown {
    position: absolute; top: calc(100% + 8px); right: 0; min-width: 180px;
    padding: var(--spacing-sm); background: var(--bg-card);
    border: 1px solid var(--border-color); border-radius: 12px;
    box-shadow: 0 10px 40px rgba(0,0,0,0.4); z-index: 100;
    opacity: 0; visibility: hidden; transform: translateY(-10px) scale(0.95);
    transition: all var(--transition-fast);

    &.show { opacity: 1; visibility: visible; transform: translateY(0) scale(1); }
  }

  .user-icon {
    display: inline-block; width: 1.2em; height: 1.2em;
    background-color: var(--accent-success);
    mask-image: url("data:image/svg+xml,%3Csvg viewBox='0 0 24 24' xmlns='http://www.w3.org/2000/svg'%3E%3Cpath d='M12 12c2.7 0 5-2.3 5-5s-2.3-5-5-5-5 2.3-5 5 2.3 5 5 5zm0 2c-3.3 0-10 1.7-10 5v3h20v-3c0-3.3-6.7-5-10-5z'/%3E%3C/svg%3E");
    mask-size: contain; mask-repeat: no-repeat; mask-position: center;
    -webkit-mask-image: url("data:image/svg+xml,%3Csvg viewBox='0 0 24 24' xmlns='http://www.w3.org/2000/svg'%3E%3Cpath d='M12 12c2.7 0 5-2.3 5-5s-2.3-5-5-5-5 2.3-5 5 2.3 5 5 5zm0 2c-3.3 0-10 1.7-10 5v3h20v-3c0-3.3-6.7-5-10-5z'/%3E%3C/svg%3E");
    -webkit-mask-size: contain; -webkit-mask-repeat: no-repeat; -webkit-mask-position: center;
  }
  .settings-divider { height: 1px; background: var(--border-color); margin: var(--spacing-xs) 0; }

  .settings-item {
    display: flex; align-items: center; gap: var(--spacing-sm);
    width: 100%; padding: var(--spacing-sm) var(--spacing-md);
    background: transparent; border: none; border-radius: 8px;
    color: var(--text-primary); font-size: 0.85rem;
    cursor: pointer; transition: all var(--transition-fast); text-decoration: none;

    &:hover { background: var(--bg-secondary); }
    &.settings-logout { color: var(--accent-fire); }
    &.settings-logout:hover { background: rgba(255, 107, 107, 0.15); }
  }

  .settings-label { flex: 1; text-align: left; }
  .settings-status { font-size: 0.75rem; color: var(--text-muted); background: var(--bg-secondary); padding: 2px 6px; border-radius: 4px; }
}

/* ===== ADD TASK FORM ===== */
.add-task-form { margin-bottom: 8px; }

.input-wrapper {
  display: flex; flex-direction: row; align-items: center; gap: 6px;
  padding: 4px 4px 4px 6px;
  background: var(--bg-secondary);
  border-radius: 10px; border: 2px solid var(--border-color); transition: all var(--transition-normal);

  &:focus-within { border-color: var(--accent-primary); box-shadow: 0 0 20px var(--shadow-color); }

  #task-input {
    flex: 1; padding: 4px 0;
    background: transparent; border: none; outline: none;
    font-size: 0.9rem; color: var(--text-primary);

    &::placeholder { color: var(--text-muted); }
  }

  .add-btn {
    display: flex; align-items: center; justify-content: center; gap: 4px;
    padding: 4px 10px;
    background: linear-gradient(135deg, var(--accent-primary), var(--accent-secondary));
    border: none; border-radius: 8px; color: white;
    font-size: 0.85rem; font-weight: 600; cursor: pointer;
    transition: all var(--transition-normal); min-height: 32px; min-width: 32px;

    &:hover { transform: translateY(-1px); box-shadow: 0 4px 15px var(--shadow-color); }
    .btn-icon { font-size: 1rem; font-weight: 300; }
    .btn-text { display: none; }
  }
}

/* ===== TASKS ===== */
.tasks-section {
  background: var(--bg-secondary); border-radius: 12px;
  padding: 8px; border: 1px solid var(--border-color); margin-top: 0;
}

.section-title {
  display: flex; align-items: center; gap: var(--spacing-sm);
  font-size: 1.1rem; font-weight: 600; margin-bottom: 10px; color: var(--text-primary);

  .title-icon { font-size: 1.3rem; }
  .task-count { font-size: 0.9rem; color: var(--text-muted); font-weight: 400; }
}

.tasks-list { list-style: none; display: flex; flex-direction: column; gap: 3px; }

.task-item {
  display: flex; align-items: center; gap: 6px; padding: 6px;
  background: var(--bg-card); border-radius: 8px; border: 1px solid var(--border-color);
  transition: all var(--transition-normal); animation: slide-in 0.4s ease;

  &:hover { border-color: var(--accent-primary); }
  &.completing { animation: task-complete 0.6s ease forwards; }

  .task-media {
    width: 28px; height: 28px; flex-shrink: 0; display: flex; align-items: center; justify-content: center;
    font-size: 16px; cursor: pointer;
  }

  .task-checkbox {
    position: relative; width: 28px; height: 28px; cursor: pointer; flex-shrink: 0;

    input {
      position: absolute; opacity: 0; width: 100%; height: 100%; cursor: pointer; z-index: 1;
      &:hover + .checkbox-custom { border-color: var(--accent-success); }
      &:checked + .checkbox-custom { background: var(--accent-success); border-color: var(--accent-success); }
      &:checked + .checkbox-custom::after { opacity: 1; transform: scale(1); }
    }

    .checkbox-custom {
      position: absolute; inset: 0; background: var(--bg-secondary);
      border: 2px solid var(--border-color); border-radius: 6px;
      transition: all var(--transition-fast);
      display: flex; align-items: center; justify-content: center;

      &::after { content: '\2714'; color: white; font-size: 14px; opacity: 0; transform: scale(0); transition: all var(--transition-fast); }
    }
  }

  .task-text {
    flex: 1; font-size: 0.85rem; color: var(--text-primary);
    transition: all var(--transition-normal); cursor: pointer; border-radius: 4px;
    min-width: 0; word-break: break-word; margin-left: 4px;

    &:hover:not([contenteditable="true"]) { background: rgba(108, 92, 231, 0.05); }
    &[contenteditable="true"] { background: rgba(108, 92, 231, 0.15); padding: 2px 4px; margin: -2px -4px; outline: none; cursor: text; min-width: 50px; }
  }

  .task-delete {
    padding: 3px; background: transparent; border: none;
    color: var(--text-muted); font-size: 0.95rem; cursor: pointer; border-radius: 6px;
    transition: all var(--transition-fast); min-width: 32px; min-height: 32px;
    display: flex; align-items: center; justify-content: center; flex-shrink: 0;

    &:hover { background: rgba(255, 107, 107, 0.2); color: var(--accent-fire); }
  }

  .task-xp {
    padding: 2px 6px; background: rgba(0, 217, 165, 0.2);
    border-radius: 16px; font-size: 0.7rem; font-weight: 600;
    color: var(--accent-success); white-space: nowrap; flex-shrink: 0;
  }
}

@keyframes task-complete {
  0% { opacity: 1; transform: translateX(0) scale(1); }
  50% { transform: translateX(20px) scale(1.02); background: var(--accent-success); }
  100% { opacity: 0; transform: translateX(100px) scale(0.8); }
}

/* ===== EMPTY STATE ===== */
.empty-state {
  text-align: center; padding: 12px var(--spacing-lg); display: none;

  &.show { display: block; animation: slide-in 0.5s ease; }

  .empty-icon { font-size: 3rem; margin-bottom: 8px; animation: bounce 2s ease-in-out infinite; }
  p { font-size: 0.9rem; color: var(--text-secondary); margin-bottom: 2px; }
  .empty-hint { font-size: 0.8rem !important; color: var(--text-muted) !important; }
}

/* ===== TABS CONTAINER ===== */
.tabs-container {
  display: flex;
  flex-direction: column;
  margin-bottom: 8px;
  background: var(--bg-secondary);
  border-radius: 10px;
  border: 1px solid var(--border-color);
  overflow: hidden;
}

/* ===== TABS NAVIGATION ===== */
.tabs-nav {
  display: flex;
  gap: 2px;
  padding: 2px;
}

.tab-btn {
  flex: 1;
  padding: 4px var(--spacing-sm);
  background: transparent;
  border: none;
  border-radius: 6px;
  color: var(--text-secondary);
  font-size: 0.8rem;
  font-weight: 600;
  letter-spacing: 0.5px;
  cursor: pointer;
  transition: all var(--transition-fast);

  &:hover { color: var(--text-primary); background: rgba(108, 92, 231, 0.1); }
  &.active { background: var(--accent-primary); color: var(--text-primary); }
}

/* ===== SOCIAL SEARCH (in tabs) ===== */
.search-input-wrapper.social-search {
  display: none;
  padding: var(--spacing-xs) var(--spacing-sm);
  padding-top: 0;
  border-top: none;
  border-radius: 0;

  &.show { display: flex; }
}

/* ===== TAB CONTENT ===== */
.tab-content {
  animation: fade-in 0.2s ease; padding: 0; margin: 0;
}

@keyframes fade-in {
  from { opacity: 0; transform: translateY(4px); }
  to { opacity: 1; transform: translateY(0); }
}

/* ===== HISTORY LIST ===== */
.history-list {
  display: flex;
  flex-direction: column;
  gap: 3px;
  list-style: none;
  padding: 0;
  margin: 0;
}

.history-item {
  display: flex;
  align-items: center;
  gap: 6px;
  padding: 6px;
  background: var(--bg-card);
  border-radius: 8px;
  border: 1px solid var(--border-color);
  animation: slide-in 0.3s ease;
}

.history-icon {
  font-size: 1rem;
  flex-shrink: 0;
}

.history-action {
  flex: 1;
  font-size: 0.85rem;
  color: var(--text-primary);
  min-width: 0;
  word-break: break-word;
}

.history-points {
  padding: 2px 6px;
  background: rgba(0, 217, 165, 0.2);
  border-radius: 16px;
  font-size: 0.7rem;
  font-weight: 600;
  color: var(--accent-success);
  white-space: nowrap;
  flex-shrink: 0;
}

.history-time {
  font-size: 0.7rem;
  color: var(--text-muted);
  white-space: nowrap;
  flex-shrink: 0;
}

/* ===== SOCIAL FEED ===== */
.social-feed {
  min-height: 150px;
}

.social-item {
  display: flex;
  flex-wrap: wrap;
  gap: 6px;
  padding: 6px;
  background: var(--bg-card);
  border-radius: 8px;
  border: 1px solid var(--border-color);
  margin-bottom: 4px;
}

.social-media {
  width: 100%;
  max-height: 300px;
  object-fit: cover;
  border-radius: 8px;
  order: -1;
}

.social-avatar {
  width: 32px;
  height: 32px;
  border-radius: 50%;
  background: var(--accent-primary);
  display: flex;
  align-items: center;
  justify-content: center;
  font-size: 0.9rem;
  flex-shrink: 0;
}

.social-content { flex: 1; }
.social-user { font-weight: 600; color: var(--accent-secondary); font-size: 0.85rem; }
.social-action { color: var(--text-secondary); font-size: 0.8rem; }
.social-time { font-size: 0.7rem; color: var(--text-muted); margin-top: 2px; }

/* ===== SEARCH ===== */
.search-container { margin-bottom: var(--spacing-lg); }

.search-input-wrapper {
  display: flex;
  gap: var(--spacing-sm);
  padding: var(--spacing-xs) var(--spacing-xs) var(--spacing-xs) var(--spacing-md);
  background: var(--bg-secondary);
  border-radius: 10px;
  border: 2px solid var(--border-color);
  transition: all var(--transition-normal);
}

.search-input-wrapper:focus-within {
  border-color: var(--accent-primary);
  box-shadow: 0 0 20px var(--shadow-color);
}

#user-search-input {
  flex: 1;
  padding: var(--spacing-sm) 0;
  background: transparent;
  border: none;
  outline: none;
  font-size: 0.95rem;
  color: var(--text-primary);
}

#user-search-input::placeholder { color: var(--text-muted); }

.search-btn {
  padding: var(--spacing-sm) var(--spacing-md);
  background: var(--accent-primary);
  border: none;
  border-radius: 8px;
  color: white;
  cursor: pointer;
  transition: all var(--transition-fast);
  min-height: 36px;
  min-width: 44px;
}

.search-btn:hover { background: var(--accent-secondary); }

.search-results {
  display: flex;
  flex-direction: column;
  gap: var(--spacing-sm);
}

/* ===== USER CARD ===== */
.user-card {
  display: flex;
  align-items: center;
  gap: 6px;
  padding: 6px;
  background: var(--bg-card);
  border-radius: 8px;
  border: 1px solid var(--border-color);
  animation: slide-in 0.3s ease;
}

.user-info {
  flex: 1;
  display: flex;
  flex-direction: column;
  gap: 2px;
}

.user-info .user-name {
  font-weight: 600;
  color: var(--text-primary);
  font-size: 0.85rem;
}

.user-info .user-level {
  font-size: 0.7rem;
  color: var(--text-muted);
}

.add-friend-btn {
  padding: 4px 8px;
  background: var(--accent-primary);
  border: none;
  border-radius: 6px;
  color: white;
  font-size: 0.75rem;
  font-weight: 600;
  cursor: pointer;
  transition: all var(--transition-fast);
  min-height: 28px;
  min-width: 70px;
}

.add-friend-btn:hover:not(:disabled) {
  background: var(--accent-secondary);
  transform: translateY(-1px);
}

.add-friend-btn:disabled {
  background: var(--bg-secondary);
  color: var(--text-muted);
  cursor: not-allowed;
}

.add-friend-btn.pending {
  background: var(--accent-warning);
  color: var(--bg-primary);
}

.add-friend-btn.accept {
  background: var(--accent-success);
}

/* ===== FRIENDS SECTIONS ===== */
.friends-section { margin-bottom: var(--spacing-lg); }

.section-subtitle {
  display: flex;
  align-items: center;
  gap: var(--spacing-sm);
  font-size: 0.95rem;
  font-weight: 600;
  margin-bottom: var(--spacing-md);
  color: var(--text-primary);
}

.badge {
  padding: 2px 8px;
  background: var(--accent-fire);
  border-radius: 12px;
  font-size: 0.75rem;
  color: white;
}

.requests-list {
  display: flex;
  flex-direction: column;
  gap: var(--spacing-sm);
}

/* ===== REQUEST ITEM ===== */
.request-item {
  display: flex;
  align-items: center;
  gap: 6px;
  padding: 6px;
  background: var(--bg-card);
  border-radius: 8px;
  border: 1px solid var(--border-color);
  animation: slide-in 0.3s ease;
}

.request-info {
  flex: 1;
  display: flex;
  flex-direction: column;
  gap: 2px;
}

.request-info .user-name {
  font-weight: 600;
  color: var(--text-primary);
  font-size: 0.85rem;
}

.request-info .request-time,
.request-info .request-status {
  font-size: 0.7rem;
  color: var(--text-muted);
}

.request-actions {
  display: flex;
  gap: 4px;
}

.accept-btn, .reject-btn, .cancel-btn {
  width: 32px;
  height: 32px;
  border: none;
  border-radius: 6px;
  font-size: 0.9rem;
  cursor: pointer;
  transition: all var(--transition-fast);
  display: flex;
  align-items: center;
  justify-content: center;
}

.accept-btn {
  background: var(--accent-success);
  color: white;
}

.accept-btn:hover { transform: scale(1.1); }

.reject-btn, .cancel-btn {
  background: rgba(255, 107, 107, 0.2);
  color: var(--accent-fire);
}

.reject-btn:hover, .cancel-btn:hover {
  background: var(--accent-fire);
  color: white;
}

/* ===== SOCIAL FEED ENHANCEMENTS ===== */
.social-meta {
  display: flex;
  gap: var(--spacing-md);
  margin-top: var(--spacing-xs);
  align-items: center;
}

.social-xp {
  padding: 2px 8px;
  background: rgba(0, 217, 165, 0.2);
  border-radius: 12px;
  font-size: 0.7rem;
  font-weight: 600;
  color: var(--accent-success);
}

.load-more-btn {
  width: 100%;
  padding: var(--spacing-md);
  background: var(--bg-card);
  border: 1px dashed var(--border-color);
  border-radius: 10px;
  color: var(--text-secondary);
  font-size: 0.85rem;
  cursor: pointer;
  transition: all var(--transition-fast);
  margin-top: var(--spacing-sm);
}

.load-more-btn:hover {
  background: var(--bg-secondary);
  border-color: var(--accent-primary);
  color: var(--accent-primary);
}

/* ===== ACHIEVEMENTS ===== */
.achievements-panel {
  margin-top: 10px; background: var(--bg-secondary); border-radius: 12px;
  padding: 10px; border: 1px solid var(--border-color); position: relative;
  overflow: hidden;

  &::after {
    content: ''; position: absolute; right: 0; top: 50px; bottom: 10px;
    width: 40px; background: linear-gradient(to right, transparent, var(--bg-secondary));
    pointer-events: none; border-radius: 0 12px 12px 0;
  }

  .panel-title { display: flex; align-items: center; gap: var(--spacing-sm); font-size: 1.1rem; margin-bottom: 10px; color: var(--text-primary); }
}

.achievements-grid {
  display: flex; overflow-x: auto; scroll-snap-type: x mandatory; gap: 8px;
  padding-bottom: 4px; -webkit-overflow-scrolling: touch; scrollbar-width: none;
  padding-right: var(--spacing-xl);

  &::-webkit-scrollbar { display: none; }
}

.achievement-item {
  flex: 0 0 100px; scroll-snap-align: start;
  display: flex; flex-direction: column; align-items: center;
  padding: 8px; background: var(--bg-card); border-radius: 10px;
  border: 2px solid var(--border-color); text-align: center;
  transition: all var(--transition-normal); opacity: 0.5; filter: grayscale(1);

  &.unlocked { opacity: 1; filter: grayscale(0); border-color: var(--accent-warning); animation: pulse 0.5s ease; }

  .achievement-icon { font-size: 2rem; margin-bottom: 4px; }
  .achievement-name { font-size: 0.75rem; font-weight: 600; color: var(--text-primary); margin-bottom: 2px; line-height: 1.2; }
  .achievement-desc { font-size: 0.65rem; color: var(--text-muted); line-height: 1.3; }
}

/* ===== POPUPS ===== */
.achievement-popup {
  position: fixed; top: var(--spacing-lg); right: var(--spacing-md); left: var(--spacing-md);
  z-index: 2000; opacity: 0; transform: translateY(-20px); pointer-events: none;
  transition: all 0.5s cubic-bezier(0.68, -0.55, 0.265, 1.55);

  &.show { opacity: 1; transform: translateY(0); }

  .popup-content {
    background: linear-gradient(135deg, var(--bg-secondary), var(--bg-card));
    border: 2px solid var(--accent-warning); border-radius: 12px;
    padding: var(--spacing-lg); text-align: center; box-shadow: 0 10px 40px rgba(255, 234, 167, 0.3);
  }

  .popup-icon { font-size: 2.5rem; animation: bounce 0.5s ease infinite alternate; }
  .popup-title { font-size: 0.8rem; color: var(--accent-warning); text-transform: uppercase; letter-spacing: 2px; margin: var(--spacing-sm) 0 var(--spacing-xs); }
  .popup-name { font-size: 1.1rem; font-weight: 700; color: var(--text-primary); }
  .popup-desc { font-size: 0.8rem; color: var(--text-secondary); margin-top: var(--spacing-xs); }
}

.levelup-popup {
  position: fixed; inset: 0; display: flex; align-items: center; justify-content: center;
  z-index: 3000; background: rgba(0,0,0,0.8); opacity: 0; pointer-events: none; transition: opacity 0.3s ease;

  &.show { opacity: 1; pointer-events: auto; }

  .levelup-content { text-align: center; animation: levelup-appear 0.6s cubic-bezier(0.68, -0.55, 0.265, 1.55); }
  .levelup-stars { font-size: 2.5rem; margin-bottom: var(--spacing-lg); animation: pulse 0.5s ease infinite alternate; }
  .levelup-title {
    font-size: 2.5rem; font-weight: 800;
    background: linear-gradient(135deg, var(--accent-warning), var(--accent-fire));
    -webkit-background-clip: text; -webkit-text-fill-color: transparent; background-clip: text;
    margin-bottom: var(--spacing-sm);
  }
  .levelup-level { font-size: 1.2rem; color: var(--text-secondary); }
}

@keyframes levelup-appear { from { transform: scale(0) rotate(-180deg); opacity: 0; } to { transform: scale(1) rotate(0deg); opacity: 1; } }

/* ===== SKELETON LOADING ===== */
.skeleton-loader {
  display: flex;
  flex-direction: column;
  gap: var(--spacing-sm);
}

.skeleton-loader.hidden {
  display: none;
}

.skeleton-task {
  height: 36px;
  background: var(--bg-card);
  border-radius: 8px;
  position: relative;
  overflow: hidden;
}

.skeleton-task::after {
  content: '';
  position: absolute;
  inset: 0;
  background: linear-gradient(90deg, transparent, rgba(255,255,255,0.1), transparent);
  animation: skeleton-shimmer 1.5s infinite;
}

@keyframes skeleton-shimmer {
  0% { transform: translateX(-100%); }
  100% { transform: translateX(100%); }
}

/* ===== DESKTOP LAYOUT ===== */
@media (min-width: 768px) {
  .app-container {
    max-width: 600px;
    margin: 0 auto;
    padding: var(--spacing-xl);
  }

  .input-wrapper .add-btn .btn-text {
    display: inline;
  }
}

@media (min-width: 1024px) {
  .app-container {
    max-width: 700px;
  }
}

/* ===== SKIP TO CONTENT ===== */
.skip-to-content {
  position: absolute;
  left: -9999px;
  top: var(--spacing-md);
  background: var(--accent-primary);
  color: var(--text-primary);
  padding: var(--spacing-sm) var(--spacing-md);
  border-radius: 4px;
  z-index: 1000;
  text-decoration: none;
  font-weight: 600;
}

.skip-to-content:focus {
  left: var(--spacing-md);
}

/* ===== REDUCED MOTION ===== */
@media (prefers-reduced-motion: reduce) {
  *,
  *::before,
  *::after {
    animation-duration: 0.01ms !important;
    animation-iteration-count: 1 !important;
    transition-duration: 0.01ms !important;
  }
}

/* ===== MEDIA POPUP ===== */
.media-popup-overlay {
  position: fixed;
  inset: 0;
  background: rgba(0, 0, 0, 0.7);
  display: flex;
  align-items: center;
  justify-content: center;
  z-index: 2500;
  opacity: 0;
  visibility: hidden;
  transition: opacity 0.3s, visibility 0.3s;
}

.media-popup-overlay.show {
  opacity: 1;
  visibility: visible;
}

.media-popup {
  background: var(--bg-secondary);
  border-radius: 16px;
  padding: 20px;
  min-width: 280px;
  max-width: 90vw;
  transform: scale(0.9);
  transition: transform 0.3s;
}

.media-popup-overlay.show .media-popup {
  transform: scale(1);
}

.media-popup-header {
  display: flex;
  justify-content: space-between;
  align-items: center;
  margin-bottom: 16px;
  font-weight: 600;
}

.media-popup-close {
  background: none;
  border: none;
  font-size: 24px;
  cursor: pointer;
  color: var(--text-secondary);
}

.media-popup-preview {
  margin-bottom: 16px;
  display: none;
}

.media-popup-preview.has-media {
  display: block;
}

.media-popup-preview img,
.media-popup-preview video {
  width: 100%;
  max-height: 200px;
  object-fit: contain;
  border-radius: 8px;
}

.media-popup-preview .delete-media-btn {
  margin-top: 8px;
  width: 100%;
  padding: 8px;
  background: #dc3545;
  color: white;
  border: none;
  border-radius: 8px;
  cursor: pointer;
}

.media-popup-preview .delete-media-btn:hover {
  background: #c82333;
}

.media-popup-actions {
  display: flex;
  flex-direction: column;
  gap: 10px;
}

.media-btn {
  padding: 12px 16px;
  border: none;
  border-radius: 10px;
  background: var(--bg-primary);
  color: var(--text-primary);
  cursor: pointer;
  font-size: 14px;
  text-align: left;
  transition: background 0.2s;
}

.media-btn:hover {
  background: var(--accent-color);
}

.media-btn.secondary {
  background: transparent;
  border: 1px solid var(--border-color);
}

.camera-view {
  margin-bottom: 16px;
}

.camera-view.hidden {
  display: none;
}

.camera-view video {
  width: 100%;
  border-radius: 8px;
  background: #000;
}

.camera-controls {
  display: flex;
  gap: 10px;
  margin-top: 10px;
}

.camera-controls .media-btn {
  flex: 1;
  text-align: center;
}

/* Task media with image */
.task-media.has-image {
  border-radius: 6px;
  overflow: hidden;
}

.task-media.has-image img,
.task-media.has-image video {
  width: 100%;
  height: 100%;
  object-fit: cover;
}

/* ===== SOCIAL LIGHTBOX ===== */
.social-lightbox {
  position: fixed;
  top: 0;
  left: 0;
  width: 100%;
  height: 100%;
  background: rgba(0, 0, 0, 0.9);
  display: flex;
  align-items: center;
  justify-content: center;
  z-index: 10000;
  opacity: 0;
  visibility: hidden;
  transition: opacity 0.2s, visibility 0.2s;
  cursor: pointer;
}

.social-lightbox.show {
  opacity: 1;
  visibility: visible;
}

.social-lightbox-content img,
.social-lightbox-content video {
  max-width: 90vw;
  max-height: 90vh;
  object-fit: contain;
  border-radius: 8px;
}

/* Fullscreen mode for video container */
.social-lightbox-content:fullscreen {
  display: flex;
  align-items: center;
  justify-content: center;
  background: #000;
}

.social-lightbox-content:fullscreen video {
  max-width: 100vw;
  max-height: 100vh;
  width: 100%;
  height: 100%;
  object-fit: contain;
  border-radius: 0;
}

/* Safari support */
.social-lightbox-content:-webkit-full-screen {
  display: flex;
  align-items: center;
  justify-content: center;
  background: #000;
}

.social-lightbox-content:-webkit-full-screen video {
  max-width: 100vw;
  max-height: 100vh;
  width: 100%;
  height: 100%;
  object-fit: contain;
  border-radius: 0;
}

.social-media {
  cursor: pointer;
}

/* Video wrapper for play overlay */
.video-wrapper {
  position: relative;
  width: 100%;
  order: -1;
}

.video-wrapper .social-media {
  width: 100%;
  display: block;
}

.video-play-overlay {
  position: absolute;
  top: 50%;
  left: 50%;
  transform: translate(-50%, -50%);
  width: 60px;
  height: 60px;
  background: rgba(0, 0, 0, 0.6);
  border-radius: 50%;
  display: flex;
  align-items: center;
  justify-content: center;
  pointer-events: none;
  transition: opacity 0.3s ease;
}

.video-play-overlay .play-icon {
  color: white;
  font-size: 24px;
  margin-left: 4px;
}

.video-wrapper.playing .video-play-overlay {
  opacity: 0;
}
