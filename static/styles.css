/* Quest Todo - Mobile-First Styles (Optimized with CSS Nesting) */

:root {
  /* Colors */
  --bg-primary: #0f0f1a;
  --bg-secondary: #1a1a2e;
  --bg-card: #252542;
  --accent-primary: #6c5ce7;
  --accent-secondary: #a29bfe;
  --accent-success: #00d9a5;
  --accent-warning: #ffeaa7;
  --accent-fire: #ff6b6b;
  --text-primary: #ffffff;
  --text-secondary: #b2b2d8;
  --text-muted: #8585a8;
  --border-color: #3d3d5c;
  --shadow-color: rgba(108, 92, 231, 0.3);
  /* Spacing */
  --spacing-xs: 4px;
  --spacing-sm: 8px;
  --spacing-md: 12px;
  --spacing-lg: 16px;
  --spacing-xl: 20px;
  /* Transitions */
  --transition-fast: 0.2s ease;
  --transition-normal: 0.3s ease;
  --transition-slow: 0.5s ease;
}

* { margin: 0; padding: 0; box-sizing: border-box; }

/* ===== FOCUS STYLES ===== */
:focus-visible {
  outline: 2px solid var(--accent-primary);
  outline-offset: 2px;
}

:focus:not(:focus-visible) {
  outline: none;
}

body {
  font-family: 'Segoe UI', system-ui, -apple-system, sans-serif;
  background: var(--bg-primary); color: var(--text-primary);
  min-height: 100vh; overflow-x: hidden;
}

/* ===== ANIMATIONS ===== */
@keyframes shine { 0% { transform: translateX(-100%); } 100% { transform: translateX(100%); } }
@keyframes pulse { 0%, 100% { transform: scale(1); } 50% { transform: scale(1.1); } }
@keyframes slide-in { from { opacity: 0; transform: translateX(-30px); } to { opacity: 1; transform: translateX(0); } }
@keyframes bounce { 0%, 100% { transform: translateY(0); } 50% { transform: translateY(-10px); } }
@keyframes spin { 0%, 100% { transform: rotate(0deg) scale(1); } 50% { transform: rotate(180deg) scale(1.2); } }
@keyframes flicker { 0% { transform: scale(1) rotate(-5deg); } 100% { transform: scale(1.1) rotate(5deg); } }

/* ===== BASE LAYOUT ===== */
.app-container { max-width: 100%; margin: 0 auto; padding: var(--spacing-md); min-height: 100vh; position: relative; }
.main-content { position: relative; }

#particles { position: fixed; inset: 0; pointer-events: none; z-index: 1000; overflow: hidden; }
.particle { position: absolute; pointer-events: none; }

/* ===== HEADER ===== */
.game-header {
  position: sticky; top: 0; z-index: 50;
  display: flex; flex-wrap: nowrap; align-items: center; gap: var(--spacing-sm);
  overflow: hidden;
  padding: var(--spacing-sm) var(--spacing-md);
  background: var(--bg-secondary); border-radius: 12px; margin-bottom: var(--spacing-md);
  border: 1px solid var(--border-color); box-shadow: 0 4px 20px rgba(0,0,0,0.3);

  .level-badge {
    display: flex; align-items: center; gap: var(--spacing-xs);
    background: linear-gradient(135deg, var(--accent-primary), var(--accent-secondary));
    padding: 6px 12px; border-radius: 20px; font-weight: 700; font-size: 0.85rem;
    white-space: nowrap; flex-shrink: 1; min-width: 0;

    .level-icon { font-size: 1rem; animation: spin 3s linear infinite; }
  }

  .xp-container { flex: 1 1 0; min-width: 50px; max-width: 200px; }

  .xp-bar {
    position: relative; height: 20px; background: var(--bg-card);
    border-radius: 10px; overflow: hidden; border: 1px solid var(--border-color);

    .xp-fill {
      height: 100%; width: 0%;
      background: linear-gradient(90deg, var(--accent-primary), var(--accent-success));
      border-radius: 9px; transition: width var(--transition-slow); position: relative;

      &::after {
        content: ''; position: absolute; inset: 0;
        background: linear-gradient(90deg, transparent, rgba(255,255,255,0.3) 50%, transparent);
        animation: shine 2s ease-in-out infinite;
      }
    }

    .xp-text {
      position: absolute; top: 50%; left: 50%; transform: translate(-50%, -50%);
      font-size: 0.7rem; font-weight: 600; text-shadow: 0 1px 2px rgba(0,0,0,0.5); white-space: nowrap;
    }
  }

  .combo-container {
    display: none; align-items: center; gap: 2px; padding: 4px 8px;
    background: var(--bg-card); border-radius: 12px; border: 1px solid var(--accent-fire); flex-shrink: 1; min-width: 0;

    &.active { display: flex; animation: pulse 0.5s ease; }
    .combo-fire { font-size: 0.9rem; animation: flicker 0.3s ease-in-out infinite alternate; }
    .combo-count { font-size: 0.85rem; font-weight: 700; color: var(--accent-fire); }
  }

  .header-right {
    display: flex; align-items: center; gap: var(--spacing-sm); margin-left: auto; flex-shrink: 1; min-width: 0;

    .stats-mini {
      display: flex; gap: var(--spacing-xs); flex-shrink: 1; min-width: 0; overflow: hidden;

      .stat-item {
        display: flex; align-items: center; gap: 2px; padding: 4px 8px;
        background: var(--bg-card); border-radius: 8px; font-weight: 600; font-size: 0.8rem;
        flex-shrink: 1; min-width: 0; white-space: nowrap;
      }
      .stat-icon { font-size: 0.85rem; }
    }

    .settings-wrapper { position: relative; }
  }
}

/* ===== SETTINGS ===== */
.settings-wrapper {
  .settings-btn {
    display: flex; align-items: center; justify-content: center;
    width: 44px; height: 44px; background: var(--bg-card);
    border: 1px solid var(--border-color); border-radius: 10px;
    cursor: pointer; transition: all var(--transition-fast);
    font-size: 1.2rem; color: var(--text-secondary);

    &:hover { background: var(--accent-primary); color: var(--text-primary); border-color: var(--accent-primary); }
  }

  .settings-dropdown {
    position: absolute; top: calc(100% + 8px); right: 0; min-width: 180px;
    padding: var(--spacing-sm); background: var(--bg-card);
    border: 1px solid var(--border-color); border-radius: 12px;
    box-shadow: 0 10px 40px rgba(0,0,0,0.4); z-index: 100;
    opacity: 0; visibility: hidden; transform: translateY(-10px) scale(0.95);
    transition: all var(--transition-fast);

    &.show { opacity: 1; visibility: visible; transform: translateY(0) scale(1); }
  }

  .settings-user {
    display: flex; align-items: center; gap: var(--spacing-sm);
    padding: var(--spacing-sm) var(--spacing-md); color: var(--text-primary);
    font-weight: 600; font-size: 0.9rem;
  }
  .user-icon { font-size: 1.2rem; }
  .settings-divider { height: 1px; background: var(--border-color); margin: var(--spacing-xs) 0; }

  .settings-item {
    display: flex; align-items: center; gap: var(--spacing-sm);
    width: 100%; padding: var(--spacing-sm) var(--spacing-md);
    background: transparent; border: none; border-radius: 8px;
    color: var(--text-primary); font-size: 0.85rem;
    cursor: pointer; transition: all var(--transition-fast); text-decoration: none;

    &:hover { background: var(--bg-secondary); }
    &.settings-logout { color: var(--accent-fire); }
    &.settings-logout:hover { background: rgba(255, 107, 107, 0.15); }
  }

  .settings-label { flex: 1; text-align: left; }
  .settings-status { font-size: 0.75rem; color: var(--text-muted); background: var(--bg-secondary); padding: 2px 6px; border-radius: 4px; }
}

/* ===== ADD TASK FORM ===== */
.add-task-form { margin-bottom: var(--spacing-lg); }

.input-wrapper {
  display: flex; flex-direction: column; gap: var(--spacing-sm);
  padding: var(--spacing-sm); background: var(--bg-secondary);
  border-radius: 12px; border: 2px solid var(--border-color); transition: all var(--transition-normal);

  &:focus-within { border-color: var(--accent-primary); box-shadow: 0 0 20px var(--shadow-color); }

  #task-input {
    flex: 1; padding: var(--spacing-md) var(--spacing-lg);
    background: transparent; border: none; outline: none;
    font-size: 1rem; color: var(--text-primary);

    &::placeholder { color: var(--text-muted); }
  }

  .add-btn {
    display: flex; align-items: center; justify-content: center; gap: var(--spacing-sm);
    padding: var(--spacing-md) var(--spacing-lg);
    background: linear-gradient(135deg, var(--accent-primary), var(--accent-secondary));
    border: none; border-radius: 10px; color: white;
    font-size: 1rem; font-weight: 600; cursor: pointer;
    transition: all var(--transition-normal); min-height: 48px;

    &:hover { transform: translateY(-2px); box-shadow: 0 8px 25px var(--shadow-color); }
    .btn-icon { font-size: 1.3rem; font-weight: 300; }
  }
}

/* ===== TASKS ===== */
.tasks-section {
  background: var(--bg-secondary); border-radius: 12px;
  padding: var(--spacing-lg); border: 1px solid var(--border-color);
}

.section-title {
  display: flex; align-items: center; gap: var(--spacing-sm);
  font-size: 1.1rem; font-weight: 600; margin-bottom: var(--spacing-lg); color: var(--text-primary);

  .title-icon { font-size: 1.3rem; }
  .task-count { font-size: 0.9rem; color: var(--text-muted); font-weight: 400; }
}

.tasks-list { list-style: none; display: flex; flex-direction: column; gap: var(--spacing-sm); }

.task-item {
  display: flex; align-items: center; gap: var(--spacing-md); padding: var(--spacing-md);
  background: var(--bg-card); border-radius: 10px; border: 1px solid var(--border-color);
  transition: all var(--transition-normal); animation: slide-in 0.4s ease;

  &:hover { border-color: var(--accent-primary); }
  &.completing { animation: task-complete 0.6s ease forwards; }

  .task-checkbox {
    position: relative; width: 32px; height: 32px; cursor: pointer; flex-shrink: 0;

    input {
      position: absolute; opacity: 0; width: 100%; height: 100%; cursor: pointer; z-index: 1;
      &:hover + .checkbox-custom { border-color: var(--accent-success); }
      &:checked + .checkbox-custom { background: var(--accent-success); border-color: var(--accent-success); }
      &:checked + .checkbox-custom::after { opacity: 1; transform: scale(1); }
    }

    .checkbox-custom {
      position: absolute; inset: 0; background: var(--bg-secondary);
      border: 2px solid var(--border-color); border-radius: 8px;
      transition: all var(--transition-fast);
      display: flex; align-items: center; justify-content: center;

      &::after { content: '\2714'; color: white; font-size: 16px; opacity: 0; transform: scale(0); transition: all var(--transition-fast); }
    }
  }

  .task-text {
    flex: 1; font-size: 0.95rem; color: var(--text-primary);
    transition: all var(--transition-normal); cursor: pointer; border-radius: 4px;
    min-width: 0; word-break: break-word;

    &:hover:not([contenteditable="true"]) { background: rgba(108, 92, 231, 0.05); }
    &[contenteditable="true"] { background: rgba(108, 92, 231, 0.15); padding: 2px 8px; margin: -2px -8px; outline: none; cursor: text; min-width: 50px; }
  }

  .task-delete {
    padding: var(--spacing-sm); background: transparent; border: none;
    color: var(--text-muted); font-size: 1.1rem; cursor: pointer; border-radius: 8px;
    transition: all var(--transition-fast); min-width: 44px; min-height: 44px;
    display: flex; align-items: center; justify-content: center; flex-shrink: 0;

    &:hover { background: rgba(255, 107, 107, 0.2); color: var(--accent-fire); }
  }

  .task-xp {
    padding: var(--spacing-xs) var(--spacing-sm); background: rgba(108, 92, 231, 0.2);
    border-radius: 20px; font-size: 0.75rem; font-weight: 600;
    color: var(--accent-secondary); white-space: nowrap; flex-shrink: 0;
  }
}

@keyframes task-complete {
  0% { opacity: 1; transform: translateX(0) scale(1); }
  50% { transform: translateX(20px) scale(1.02); background: var(--accent-success); }
  100% { opacity: 0; transform: translateX(100px) scale(0.8); }
}

/* ===== EMPTY STATE ===== */
.empty-state {
  text-align: center; padding: var(--spacing-xl) var(--spacing-lg); display: none;

  &.show { display: block; animation: slide-in 0.5s ease; }

  .empty-icon { font-size: 3rem; margin-bottom: var(--spacing-md); animation: bounce 2s ease-in-out infinite; }
  p { font-size: 1rem; color: var(--text-secondary); margin-bottom: var(--spacing-xs); }
  .empty-hint { font-size: 0.85rem !important; color: var(--text-muted) !important; }
}

/* ===== ACHIEVEMENTS ===== */
.achievements-panel {
  margin-top: var(--spacing-lg); background: var(--bg-secondary); border-radius: 12px;
  padding: var(--spacing-lg); border: 1px solid var(--border-color); position: relative;
  overflow: hidden;

  &::after {
    content: ''; position: absolute; right: 0; top: 60px; bottom: var(--spacing-lg);
    width: 40px; background: linear-gradient(to right, transparent, var(--bg-secondary));
    pointer-events: none; border-radius: 0 12px 12px 0;
  }

  .panel-title { display: flex; align-items: center; gap: var(--spacing-sm); font-size: 1.1rem; margin-bottom: var(--spacing-lg); color: var(--text-primary); }
}

.achievements-grid {
  display: flex; overflow-x: auto; scroll-snap-type: x mandatory; gap: var(--spacing-md);
  padding-bottom: var(--spacing-sm); -webkit-overflow-scrolling: touch; scrollbar-width: none;
  padding-right: var(--spacing-xl);

  &::-webkit-scrollbar { display: none; }
}

.achievement-item {
  flex: 0 0 100px; scroll-snap-align: start;
  display: flex; flex-direction: column; align-items: center;
  padding: var(--spacing-md); background: var(--bg-card); border-radius: 10px;
  border: 2px solid var(--border-color); text-align: center;
  transition: all var(--transition-normal); opacity: 0.5; filter: grayscale(1);

  &.unlocked { opacity: 1; filter: grayscale(0); border-color: var(--accent-warning); animation: pulse 0.5s ease; }

  .achievement-icon { font-size: 2rem; margin-bottom: var(--spacing-sm); }
  .achievement-name { font-size: 0.75rem; font-weight: 600; color: var(--text-primary); margin-bottom: var(--spacing-xs); line-height: 1.2; }
  .achievement-desc { font-size: 0.65rem; color: var(--text-muted); line-height: 1.3; }
}

/* ===== POPUPS ===== */
.achievement-popup {
  position: fixed; top: var(--spacing-lg); right: var(--spacing-md); left: var(--spacing-md);
  z-index: 2000; opacity: 0; transform: translateY(-20px); pointer-events: none;
  transition: all 0.5s cubic-bezier(0.68, -0.55, 0.265, 1.55);

  &.show { opacity: 1; transform: translateY(0); }

  .popup-content {
    background: linear-gradient(135deg, var(--bg-secondary), var(--bg-card));
    border: 2px solid var(--accent-warning); border-radius: 12px;
    padding: var(--spacing-lg); text-align: center; box-shadow: 0 10px 40px rgba(255, 234, 167, 0.3);
  }

  .popup-icon { font-size: 2.5rem; animation: bounce 0.5s ease infinite alternate; }
  .popup-title { font-size: 0.8rem; color: var(--accent-warning); text-transform: uppercase; letter-spacing: 2px; margin: var(--spacing-sm) 0 var(--spacing-xs); }
  .popup-name { font-size: 1.1rem; font-weight: 700; color: var(--text-primary); }
  .popup-desc { font-size: 0.8rem; color: var(--text-secondary); margin-top: var(--spacing-xs); }
}

.levelup-popup {
  position: fixed; inset: 0; display: flex; align-items: center; justify-content: center;
  z-index: 3000; background: rgba(0,0,0,0.8); opacity: 0; pointer-events: none; transition: opacity 0.3s ease;

  &.show { opacity: 1; pointer-events: auto; }

  .levelup-content { text-align: center; animation: levelup-appear 0.6s cubic-bezier(0.68, -0.55, 0.265, 1.55); }
  .levelup-stars { font-size: 2.5rem; margin-bottom: var(--spacing-lg); animation: pulse 0.5s ease infinite alternate; }
  .levelup-title {
    font-size: 2.5rem; font-weight: 800;
    background: linear-gradient(135deg, var(--accent-warning), var(--accent-fire));
    -webkit-background-clip: text; -webkit-text-fill-color: transparent; background-clip: text;
    margin-bottom: var(--spacing-sm);
  }
  .levelup-level { font-size: 1.2rem; color: var(--text-secondary); }
}

@keyframes levelup-appear { from { transform: scale(0) rotate(-180deg); opacity: 0; } to { transform: scale(1) rotate(0deg); opacity: 1; } }

/* ===== SKELETON LOADING ===== */
.skeleton-loader {
  display: flex;
  flex-direction: column;
  gap: var(--spacing-sm);
}

.skeleton-loader.hidden {
  display: none;
}

.skeleton-task {
  height: 56px;
  background: var(--bg-card);
  border-radius: 10px;
  position: relative;
  overflow: hidden;
}

.skeleton-task::after {
  content: '';
  position: absolute;
  inset: 0;
  background: linear-gradient(90deg, transparent, rgba(255,255,255,0.1), transparent);
  animation: skeleton-shimmer 1.5s infinite;
}

@keyframes skeleton-shimmer {
  0% { transform: translateX(-100%); }
  100% { transform: translateX(100%); }
}

/* ===== DESKTOP LAYOUT ===== */
@media (min-width: 768px) {
  .app-container {
    max-width: 600px;
    margin: 0 auto;
    padding: var(--spacing-xl);
  }

  .input-wrapper {
    flex-direction: row;
    align-items: stretch;
  }

  #task-input {
    flex: 1;
  }

  .add-btn {
    width: auto;
    flex-shrink: 0;
  }
}

@media (min-width: 1024px) {
  .app-container {
    max-width: 700px;
  }
}

/* ===== SKIP TO CONTENT ===== */
.skip-to-content {
  position: absolute;
  left: -9999px;
  top: var(--spacing-md);
  background: var(--accent-primary);
  color: var(--text-primary);
  padding: var(--spacing-sm) var(--spacing-md);
  border-radius: 4px;
  z-index: 1000;
  text-decoration: none;
  font-weight: 600;
}

.skip-to-content:focus {
  left: var(--spacing-md);
}

/* ===== REDUCED MOTION ===== */
@media (prefers-reduced-motion: reduce) {
  *,
  *::before,
  *::after {
    animation-duration: 0.01ms !important;
    animation-iteration-count: 1 !important;
    transition-duration: 0.01ms !important;
  }
}
