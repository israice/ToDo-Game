<!DOCTYPE html>
<html lang="ru">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>ToDo Game - –ì–µ–π–º–∏—Ñ–∏—Ü–∏—Ä–æ–≤–∞–Ω–Ω—ã–π –ø–ª–∞–Ω–∏—Ä–æ–≤—â–∏–∫ –∑–∞–¥–∞—á</title>
    <link rel="icon" href="data:image/svg+xml,<svg xmlns='http://www.w3.org/2000/svg' viewBox='0 0 100 100'><text y='.9em' font-size='90'>üéØ</text></svg>">
    <!-- Prevent HTML caching -->
    <meta http-equiv="Cache-Control" content="no-cache, no-store, must-revalidate">
    <meta http-equiv="Pragma" content="no-cache">
    <meta http-equiv="Expires" content="0">
    <link rel="stylesheet" href="{{ url_for('static', filename='styles.css', v=app_version) }}">
</head>
<body>
    <a href="#tasks-list" class="skip-to-content">–ü–µ—Ä–µ–π—Ç–∏ –∫ –∑–∞–¥–∞—á–∞–º</a>
    <div class="app-container">
        <!-- Particles container for effects -->
        <div id="particles"></div>

        <!-- Compact horizontal header -->
        <header class="game-header" id="game-header">
            <div class="level-row">
                <div class="level-badge">
                    <span class="level-icon">&#9733;</span>
                    <span class="level-text">LVL <span id="level">1</span></span>
                </div>
                <div class="xp-container">
                    <div class="xp-bar">
                        <div class="xp-fill" id="xp-fill"></div>
                        <span class="xp-text"><span id="xp">0</span>/<span id="xp-max">100</span></span>
                    </div>
                </div>
                <!-- Settings button with dropdown -->
                <div class="settings-wrapper">
                    <button class="settings-btn" id="settings-toggle" aria-label="–ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å">
                        <span class="user-icon"></span>
                    </button>
                    <div class="settings-dropdown" id="settings-dropdown">
                        <button class="settings-item" id="user-profile-btn">
                            <span class="user-icon"></span>
                            <span class="settings-label">{{ user }}</span>
                        </button>
                        <div class="settings-divider"></div>
                        <button class="settings-item" id="sound-toggle">
                            <span id="sound-icon">&#128264;</span>
                            <span class="settings-label">–ó–≤—É–∫</span>
                            <span class="settings-status" id="sound-status">OFF</span>
                        </button>
                        <div class="settings-divider"></div>
                        <button class="settings-item" id="version-btn">
                            <span>&#128736;</span>
                            <span class="settings-label">–í–µ—Ä—Å–∏—è</span>
                            <span class="settings-status">{{ version }}</span>
                        </button>
                        <div class="settings-divider"></div>
                        <button class="settings-item" id="settings-btn">
                            <span>&#9881;</span>
                            <span class="settings-label">–ù–∞—Å—Ç—Ä–æ–π–∫–∏</span>
                        </button>
                        <div class="settings-divider"></div>
                        <a href="/logout" class="settings-item settings-logout">
                            <span>&#128682;</span>
                            <span class="settings-label">–í—ã–π—Ç–∏</span>
                        </a>
                    </div>
                </div>
            </div>

            <div class="header-right">
                <div class="stats-mini">
                    <div class="stat-item" aria-label="–í—ã–ø–æ–ª–Ω–µ–Ω–Ω—ã–µ –∫–≤–µ—Å—Ç—ã">
                        <span class="stat-icon" aria-hidden="true">&#9989;</span>
                        <span id="tasks-completed">0</span>
                    </div>
                    <div class="stat-item" aria-label="–î–Ω–µ–≤–Ω–∞—è —Å–µ—Ä–∏—è">
                        <span class="stat-icon" aria-hidden="true">&#128293;</span>
                        <span id="streak-count">0</span>
                    </div>
                    <div class="stat-item" aria-label="–î–æ—Å—Ç–∏–∂–µ–Ω–∏—è">
                        <span class="stat-icon" aria-hidden="true">&#127942;</span>
                        <span id="achievements-count">0</span>
                    </div>
                </div>

                <!-- Combo indicator -->
                <div class="combo-container" id="combo-container">
                    <span class="combo-fire">&#128293;</span>
                    <span class="combo-count">x<span id="combo">0</span></span>
                </div>
            </div>

        </header>

        <!-- Main content -->
        <main class="main-content">
            <!-- Tabs Navigation Container -->
            <div class="tabs-container" id="tabs-container">
                <nav class="tabs-nav" id="tabs-nav" role="tablist">
                    <button class="tab-btn active" data-tab="todo" role="tab" aria-selected="true" aria-controls="tab-todo">TODO</button>
                    <button class="tab-btn" data-tab="social" role="tab" aria-selected="false" aria-controls="tab-social">SOCIAL</button>
                    <button class="tab-btn" data-tab="history" role="tab" aria-selected="false" aria-controls="tab-history">HISTORY</button>
                </nav>
                <div class="search-input-wrapper social-search" id="social-search">
                    <input type="text" id="user-search-input"
                           placeholder="–ü–æ–∏—Å–∫ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–π..."
                           autocomplete="off" minlength="2">
                    <button class="search-btn" id="user-search-btn">
                        <span>&#128269;</span>
                    </button>
                </div>
            </div>

            <!-- Tab: TODO -->
            <div class="tab-content" id="tab-todo" role="tabpanel" style="display: block;">
                <!-- Add task form -->
                <form class="add-task-form" id="add-task-form" role="form" aria-label="–î–æ–±–∞–≤–∏—Ç—å –Ω–æ–≤—ã–π –∫–≤–µ—Å—Ç">
                    <div class="input-wrapper">
                        <input
                            type="text"
                            id="task-input"
                            placeholder="–ö–∞–∫–æ–π –∫–≤–µ—Å—Ç –∂–¥—ë—Ç —Ç–µ–±—è —Å–µ–≥–æ–¥–Ω—è?"
                            autocomplete="off"
                            maxlength="100"
                        >
                        <button type="submit" class="add-btn" id="add-btn">
                            <span class="btn-icon">+</span>
                            <span class="btn-text">–î–æ–±–∞–≤–∏—Ç—å</span>
                        </button>
                    </div>
                </form>

                <!-- Tasks list -->
                <div class="tasks-section">
                    <h2 class="section-title">
                        <span class="title-icon">&#128221;</span>
                        –ê–∫—Ç–∏–≤–Ω—ã–µ –∫–≤–µ—Å—Ç—ã
                        <span class="task-count" id="task-count">(0)</span>
                    </h2>

                    <div class="skeleton-loader" id="skeleton-loader">
                        <div class="skeleton-task"></div>
                        <div class="skeleton-task"></div>
                        <div class="skeleton-task"></div>
                    </div>

                    <ul class="tasks-list" id="tasks-list" role="list" aria-live="polite">
                        <!-- Tasks will be rendered here -->
                    </ul>

                    <div class="empty-state" id="empty-state">
                        <div class="empty-icon">&#127919;</div>
                        <p>–ö–≤–µ—Å—Ç–æ–≤ –ø–æ–∫–∞ –Ω–µ—Ç!</p>
                        <p class="empty-hint">–î–æ–±–∞–≤—å —Å–≤–æ–π –ø–µ—Ä–≤—ã–π –∫–≤–µ—Å—Ç –≤—ã—à–µ</p>
                    </div>
                </div>

                <!-- Achievements panel -->
                <aside class="achievements-panel" id="achievements-panel">
                    <h3 class="panel-title">
                        <span>&#127942;</span> –î–æ—Å—Ç–∏–∂–µ–Ω–∏—è
                    </h3>
                    <div class="achievements-grid" id="achievements-grid">
                        <!-- Achievements will be rendered here -->
                    </div>
                </aside>
            </div>

            <!-- Tab: SOCIAL -->
            <div class="tab-content" id="tab-social" role="tabpanel" style="display: none;">
                <!-- Search results (shown above feed when searching) -->
                <div class="search-results" id="search-results"></div>
                <div class="empty-state" id="search-empty">–ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–∏ –Ω–µ –Ω–∞–π–¥–µ–Ω—ã</div>

                <!-- Incoming requests section -->
                <div class="friends-section" id="incoming-requests-section" style="display: none;">
                    <h3 class="section-subtitle">
                        <span>&#128229;</span> –í—Ö–æ–¥—è—â–∏–µ –∑–∞—è–≤–∫–∏
                        <span class="badge" id="incoming-count">0</span>
                    </h3>
                    <div class="requests-list" id="incoming-requests"></div>
                </div>

                <!-- Outgoing requests section -->
                <div class="friends-section" id="outgoing-requests-section" style="display: none;">
                    <h3 class="section-subtitle">
                        <span>&#128228;</span> –ò—Å—Ö–æ–¥—è—â–∏–µ –∑–∞—è–≤–∫–∏
                    </h3>
                    <div class="requests-list" id="outgoing-requests"></div>
                </div>

                <!-- Friends feed section -->
                <div class="friends-section" id="friends-feed-section">
                    <h3 class="section-subtitle">
                        <span>&#128101;</span> –õ–µ–Ω—Ç–∞ –¥—Ä—É–∑–µ–π
                    </h3>
                    <div class="social-feed" id="friends-feed"></div>
                    <button class="load-more-btn" id="load-more-feed" style="display: none;">
                        –ó–∞–≥—Ä—É–∑–∏—Ç—å –µ—â—ë
                    </button>
                </div>

                <div class="empty-state" id="friends-empty">
                    <div class="empty-icon">&#128101;</div>
                    <p>–£ –≤–∞—Å –ø–æ–∫–∞ –Ω–µ—Ç –¥—Ä—É–∑–µ–π</p>
                    <p class="empty-hint">–ò—Å–ø–æ–ª—å–∑—É–π—Ç–µ –ø–æ–∏—Å–∫ –≤—ã—à–µ, —á—Ç–æ–±—ã –Ω–∞–π—Ç–∏ –¥—Ä—É–∑–µ–π</p>
                </div>
            </div>

            <!-- Tab: HISTORY -->
            <div class="tab-content" id="tab-history" role="tabpanel" style="display: none;">
                <ul class="history-list" id="history-list">
                    <!-- History items will be rendered here -->
                </ul>
                <div class="empty-state" id="history-empty">
                    <div class="empty-icon">&#128220;</div>
                    <p>–ò—Å—Ç–æ—Ä–∏—è –ø–æ–∫–∞ –ø—É—Å—Ç–∞</p>
                    <p class="empty-hint">–í—ã–ø–æ–ª–Ω—è–π –∫–≤–µ—Å—Ç—ã, —á—Ç–æ–±—ã —É–≤–∏–¥–µ—Ç—å –∏—Å—Ç–æ—Ä–∏—é</p>
                </div>
            </div>
        </main>

        <!-- Achievement popup -->
        <div class="achievement-popup" id="achievement-popup" role="alert" aria-live="assertive">
            <div class="popup-content">
                <div class="popup-icon" id="popup-icon">&#127942;</div>
                <div class="popup-title">–î–æ—Å—Ç–∏–∂–µ–Ω–∏–µ —Ä–∞–∑–±–ª–æ–∫–∏—Ä–æ–≤–∞–Ω–æ!</div>
                <div class="popup-name" id="popup-name"></div>
                <div class="popup-desc" id="popup-desc"></div>
            </div>
        </div>

        <!-- Level up popup -->
        <div class="levelup-popup" id="levelup-popup" role="dialog" aria-live="assertive" aria-label="–£–≤–µ–¥–æ–º–ª–µ–Ω–∏–µ –æ –Ω–æ–≤–æ–º —É—Ä–æ–≤–Ω–µ">
            <div class="levelup-content">
                <div class="levelup-stars">&#10024; &#10024; &#10024;</div>
                <div class="levelup-title">–ù–û–í–´–ô –£–†–û–í–ï–ù–¨!</div>
                <div class="levelup-level">–£—Ä–æ–≤–µ–Ω—å <span id="new-level">2</span></div>
            </div>
        </div>

        <!-- Media Popup -->
        <div id="media-popup" class="media-popup-overlay" role="dialog" aria-label="–î–æ–±–∞–≤–∏—Ç—å –º–µ–¥–∏–∞">
            <div class="media-popup">
                <div class="media-popup-header">
                    <span>–î–æ–±–∞–≤–∏—Ç—å –º–µ–¥–∏–∞</span>
                    <button class="media-popup-close" id="media-popup-close" aria-label="–ó–∞–∫—Ä—ã—Ç—å">&times;</button>
                </div>
                <div class="media-popup-preview" id="media-preview"></div>
                <div class="camera-view hidden" id="camera-view">
                    <video id="camera-video" autoplay playsinline></video>
                    <div class="camera-controls">
                        <button class="media-btn" id="btn-camera-capture">üì∏ –°–Ω—è—Ç—å</button>
                        <button class="media-btn secondary" id="btn-camera-cancel">–û—Ç–º–µ–Ω–∞</button>
                    </div>
                </div>
                <div class="media-popup-actions">
                    <button class="media-btn" id="btn-take-photo">üì∑ –°–¥–µ–ª–∞—Ç—å —Å–Ω–∏–º–æ–∫</button>
                    <button class="media-btn" id="btn-take-video">üé• –°–¥–µ–ª–∞—Ç—å –≤–∏–¥–µ–æ</button>
                    <button class="media-btn" id="btn-add-media">üìÅ –î–æ–±–∞–≤–∏—Ç—å –º–µ–¥–∏–∞</button>
                </div>
                <input type="file" id="media-file-input" accept="image/*,video/*" hidden>
            </div>
        </div>

        <!-- Lightbox for social feed media -->
        <div id="social-lightbox" class="social-lightbox">
            <div class="social-lightbox-content" id="social-lightbox-content"></div>
        </div>

    </div>

    <script src="https://cdn.socket.io/4.7.2/socket.io.min.js"></script>
    <script src="{{ url_for('static', filename='app.js', v=app_version) }}"></script>
</body>
</html>
